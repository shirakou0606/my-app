# 営業・コミュニケーション学習支援システム

教育向けフィードバック基準に基づいた、営業・コミュニケーション分野の学習支援プラットフォームです。AIによる自動フィードバック生成機能を搭載し、学習者の成長を支援します。

## 🎯 プロジェクトの目標

- 営業・コミュニケーションスキルの体系的な学習支援
- **3階層構造（大カテゴリー→中トピック→小トピック）による学習の整理**
- 建設的で具体的なフィードバックによる成長促進
- 教育者と学習者の効率的な学習管理

## ✨ 主な機能

### 完成済み機能

#### 1. **ユーザー管理**
- ロール別ログイン（管理者/学習者）
- セッション管理による自動ログイン
- 複数学習者対応（20〜100人規模）

#### 2. **管理者機能**
- **🎯 テキストから自動問題生成（NEW!）**
  - **大カテゴリー選択**（営業 / コミュニケーション）
  - **中トピック入力**（例：顧客ヒアリングの基本、プレゼンテーション技術など）
  - 学習テキストを貼り付けるだけで自動的に5問を生成
  - **1中トピック内に複数の小トピック（問題セット）を作成可能**
  - **1小トピック = 5問セット = 100点満点** の構成
  - 選択式3問 + 記述式2問の最適な組み合わせ
  - プレビュー機能で生成結果を確認してから保存
  
- 手動問題作成・管理
  - 選択式問題の作成
  - 記述式問題の作成
  - カテゴリ設定（営業/コミュニケーション）
  - 解説・評価基準の登録
  
- 学習者ダッシュボード
  - 学習者一覧表示
  - 回答数・フィードバック数の統計
  - 完了率の可視化

#### 3. **学習者機能**
- **📚 3階層の学習ナビゲーション（NEW!）**
  1. **大カテゴリー選択**：営業 or コミュニケーション
  2. **中トピック選択**：選択した大カテゴリー内の中トピック一覧から選択
  3. **小トピック選択**：選択した中トピック内の小トピック（問題セット）から選択
  
- 問題一覧の閲覧
  - 階層的なナビゲーション
  - 回答済み/未回答のステータス表示
  - 進捗率の可視化
  
- 回答機能
  - 選択式：ラジオボタンによる選択
  - 記述式：テキストエリアでの自由記述
  
- **💯 100点満点の採点システム（セット単位）**
  - **1セット（5問）で100点満点**
    - 選択式: **15点 × 3問 = 45点**
    - 記述式: **25点 + 30点 = 55点**
  - 選択式：正解で満点、不正解で0点
  - 記述式：4つの観点から詳細採点
    - テキストとの一致度（50%）
    - 重要キーワードの使用（20%）
    - 具体性（15%）
    - 論理性・構造（15%）
  - 問題ごとの得点表示
  - 採点内訳の可視化
  
- フィードバック表示
  - 問題ごとの得点とパーセンテージ
  - 配点情報の明示（15点/25点/30点）
  - 採点内訳グラフ（記述式）
  - 5段階構造（固定順序）
    1. できている点（Good Point）
    2. 惜しい点（Partial）
    3. 修正が必要な点（Correction）
    4. 理由（Why）
    5. 次に意識する一点（Next Action）
  - 最終まとめコメント

#### 4. **AIフィードバック生成**
- 選択式問題の自動評価
  - 正誤判定
  - 選択理由の分析
  - 改善提案
  
- 記述式問題の自動評価
  - **テキストとの一致度分析**
  - **配点に応じた詳細採点（25点 or 30点）**
  - キーワード分析
  - 文章構造の評価
  - 具体性・再現性の評価

## 🗂️ データ構造

### テーブル一覧

#### question_sets（問題セット）
- `id`: セットID（UUID）
- `title`: セットのタイトル（小トピック名）
- `category`: 大カテゴリー（営業 / コミュニケーション）
- **`mid_topic`: 中トピック名（NEW!）**
- `source_text`: 元となる学習テキスト
- `created_by`: 作成者ID
- `created_at`: 作成日時

#### users（ユーザー）
- `id`: ユーザーID（UUID）
- `name`: ユーザー名
- `email`: メールアドレス
- `role`: 役割（admin / learner）
- `created_at`: 登録日時

#### questions（問題）
- `id`: 問題ID（UUID）
- `title`: 問題タイトル（セットID・問題番号・配点を含む）
- `category`: カテゴリ（営業 / コミュニケーション）
- `type`: 問題形式（choice / essay）
- `question_text`: 問題文
- `choices`: 選択肢（JSON配列）
- `correct_answer`: 正解
- `explanation`: 解説・評価基準（セットID・問題番号・配点・元テキストを含む）
- `created_by`: 作成者ID
- `created_at`: 作成日時

#### answers（回答）
- `id`: 回答ID（UUID）
- `user_id`: 回答者ID
- `question_id`: 問題ID
- `answer_text`: 回答内容
- `submitted_at`: 提出日時

#### feedbacks（フィードバック）
- `id`: フィードバックID（UUID）
- `answer_id`: 回答ID
- `good_point`: できている点
- `partial_point`: 惜しい点
- `correction_point`: 修正が必要な点
- `reason`: 理由（採点結果を含む）
- `next_action`: 次に意識する一点
- `rubric_scores`: 採点情報（JSON: score, maxScore, breakdown）
- `final_comment`: 最終まとめコメント
- `created_at`: 生成日時

## 📁 ファイル構成

```
/
├── index.html                    # メインHTML
├── css/
│   └── style.css                # スタイルシート
├── js/
│   ├── main.js                  # メインアプリケーション
│   ├── security.js              # セキュリティ機能
│   ├── utils.js                 # ユーティリティ関数
│   ├── api.js                   # API通信
│   ├── question-generator.js   # 自動問題生成 (NEW!)
│   ├── scoring.js               # 100点満点採点システム (NEW!)
│   ├── ai.js                    # AIフィードバック生成
│   ├── admin.js                 # 管理者画面ロジック
│   └── learner.js               # 学習者画面ロジック
├── README.md                     # このファイル
└── SECURITY.md                   # セキュリティガイド
```

## 🔐 セキュリティ機能

### 実装済みセキュリティ対策

#### 1. **認証とアクセス制御**
- **管理者専用ログイン画面の分離**
  - 学習者は管理者機能にアクセス不可
  - 管理者は専用ページからのみログイン可能
  
- **パスワード認証（管理者のみ）**
  - SHA-256によるパスワードハッシュ化
  - 初回ログイン時にパスワード設定
  - パスワード強度チェック
    - 8文字以上
    - 大文字・小文字・数字・記号を含む

#### 2. **ブルートフォース攻撃対策**
- **レート制限機能**
  - 15分間に5回までのログイン試行制限
  - 上限到達時は15分間ロック
  - 試行回数の表示

#### 3. **セッション管理**
- **セッショントークン**
  - 暗号学的に安全なランダムトークン生成
  - セッション有効期限の管理
    - 学習者: 24時間
    - 管理者: 8時間（短めに設定）
  - 期限切れセッションの自動ログアウト

#### 4. **データ保護**
- **XSS（クロスサイトスクリプティング）対策**
  - 全ユーザー入力のサニタイズ
  - HTMLエスケープ処理
  
- **データ暗号化機能**
  - AES-GCM暗号化アルゴリズム
  - 機密データの暗号化保存機能
  
- **入力バリデーション**
  - メールアドレス形式チェック
  - 必須項目の検証

#### 5. **その他のセキュリティ機能**
- セキュアなログアウト（メモリクリア）
- CSRFトークン生成機能
- データ整合性チェック

### セキュリティ上の注意事項

#### LocalStorageの使用について
- パスワードは**ハッシュ化されて**保存されます（平文では保存されません）
- セッション情報は暗号化されたトークンで管理
- ブラウザのLocalStorageを使用するため、同一ブラウザでのみ有効

#### 推奨される運用方法
1. **管理者パスワードは強力なものを設定**
   - 例: `Admin@2026!SecurePass`
   
2. **共有PCでの使用後は必ずログアウト**
   
3. **定期的なパスワード変更**（今後の機能追加予定）
   
4. **管理者権限の適切な管理**
   - 管理者アカウントは必要最小限に
   - 学習者が管理者パスワードを知らないように管理

#### 本番環境での追加推奨事項
- HTTPS通信の使用（必須）
- サーバーサイド認証の導入
- データベースの暗号化
- 監査ログの記録
- バックアップの実施

## 🚀 使い方

### 🔧 トラブルシューティング

#### 「管理者の方はこちら」ボタンが押せない場合
**v5.1.4で完全修正済み**
- HTMLとJavaScriptの両方からアプローチして確実にクリックできるように改善
- 複数のフォールバック機構を実装

**修正内容：**
1. HTMLリンクに`onclick`属性を追加（直接実行）
2. JavaScriptで`addEventListener`と`onclick`の二重設定
3. グローバル関数`window.switchToAdminLogin`を追加
4. インラインスタイルでクリック可能性を明示
5. ホバー効果を追加して視覚的フィードバックを強化

**動作確認方法：**
1. ページを開く
2. 「管理者の方はこちら」リンクにマウスを乗せる
   - 背景色が薄い青色に変わる
   - リンクが少し上に浮く
   - アイコンが拡大する
3. クリックすると管理者ログイン画面に遷移
4. F12 → Consoleで`=== Admin login link clicked ===`が表示される

**それでも動かない場合：**
- ブラウザのコンソール（F12 → Console）を開く
- 以下のコマンドを直接入力して実行：
  ```javascript
  window.switchToAdminLogin()
  ```

#### 回答完了時にエラーが発生する場合
**v5.1.2で対応強化済み**
- エラーハンドリングを強化し、詳細なエラーメッセージを表示するように改善
- 問題の原因に応じた対処方法を提示

**よくあるエラーと対処法：**

1. **「sanitizeHTML関数が見つかりません」**
   - 原因：JavaScriptの読み込み順序の問題
   - 対処：ページを再読み込み（F5キー）してください

2. **「回答データが正しく保存されていません」**
   - 原因：回答データの保存に失敗
   - 対処：もう一度テストを受けてください

3. **「ログイン情報が失われています」**
   - 原因：セッションが切れた
   - 対処：再度ログインしてください

4. **「フィードバック生成に失敗しました」**
   - 原因：AIフィードバックの生成処理でエラー
   - 対処：ブラウザのF12→Consoleタブでエラー詳細を確認

5. **「記述式採点でエラーが発生しました」**
   - 原因：採点処理のエラー
   - 対処：問題の元テキストが正しく保存されているか確認

**デバッグ方法：**
1. ブラウザでF12キーを押して開発者ツールを開く
2. Consoleタブを選択
3. テストを完了したときのエラーログを確認：
   - `=== Complete Test START ===` から始まるログ
   - 赤いエラーメッセージとスタックトレース
   - 各処理ステップの成功・失敗ログ

#### ログアウトボタンやカテゴリーカードが押せない場合
**v5.1.1で修正済み**
- HTMLのインラインイベントハンドラ（onclick属性）とJavaScriptのイベントリスナーが競合していた問題を解決
- イベントリスナーの重複登録を防止するためにイベントデリゲーションとクローン方式を採用
- ログアウトボタンとカテゴリーカードのクリックが正常に動作するように修正

**動作確認方法：**
1. ブラウザでF12キーを押して開発者ツールを開く
2. Consoleタブを選択
3. 各ボタンをクリックしたときにログが表示されることを確認：
   - ログアウトボタン → `=== Learner/Admin logout button clicked ===`
   - カテゴリーカード → `Category clicked: 営業` or `Category clicked: コミュニケーション`

### 管理者として利用

1. **初回登録・ログイン**
   - トップページで「管理者の方はこちら」をクリック
   - 名前、メールアドレスを入力
   - **パスワードを設定**（初回のみ）
     - 8文字以上
     - 大文字・小文字・数字・記号を含む
   - 「管理者ログイン」ボタンをクリック

2. **2回目以降のログイン**
   - トップページで「管理者の方はこちら」をクリック
   - メールアドレスとパスワードを入力
   - 「管理者ログイン」ボタンをクリック

3. **📝 テキストから自動問題生成（推奨）**
   - 「問題管理」タブの「テキストから自動問題生成」セクションへ
   - **大カテゴリーを選択**（営業 or コミュニケーション）
   - **中トピック名を入力**（例：「顧客ヒアリングの基本」「プレゼンテーション技術」など）
   - 学習テキストを貼り付け（200文字以上推奨）
     - テキストの最初に小トピック名を含めると分かりやすい
     - 例：【タイトル】潜在ニーズを引き出す質問技法
   - 「5問を自動生成してプレビュー」ボタンをクリック
   - 生成された問題を確認（中トピック名も表示される）
   - 「この5問をすべて保存」ボタンで一括保存

4. **手動で問題を作成（カスタマイズしたい場合）**
   - 「手動で問題を作成」セクションへ
   - 問題タイトル、カテゴリ、問題形式を入力
   - 選択式の場合：選択肢を追加し、正解番号を入力
   - 記述式の場合：評価基準を入力
   - 「問題を保存」ボタンをクリック

5. **学習者の進捗を確認**
   - 「ダッシュボード」タブに移動
   - 学習者一覧と統計を確認

### 学習者として利用

1. **ログイン**
   - 名前、メールアドレスを入力
   - 「ログイン」ボタンをクリック
   - ※パスワードは不要です（学習者は簡単にアクセス可能）

2. **📁 大カテゴリーを選択（NEW!）**
   - ログイン後、大カテゴリー選択画面が表示される
   - **営業** または **コミュニケーション** を選択
   - 各カテゴリーに含まれる中トピック数が表示される

3. **📚 中トピックを選択（NEW!）**
   - 選択した大カテゴリー内の中トピック一覧が表示される
   - 例：
     - 営業カテゴリー内：「顧客ヒアリングの基本」「クロージング技法」など
     - コミュニケーションカテゴリー内：「効果的な質問技法」「傾聴スキル」など
   - 各中トピックには含まれる小トピック（問題セット）数が表示される
   - 学習したい中トピックをクリック

4. **📖 小トピック（問題セット）を選択（NEW!）**
   - 選択した中トピック内の小トピック一覧が表示される
   - 各小トピックには以下の情報が表示：
     - 小トピック名
     - 進捗状況（未完了/完了）
     - 配点情報（5問・100点満点）
     - 所要時間（約15分）
   - 小トピックをクリックまたは「テストを開始」ボタンをクリック

5. **🎯 テスト開始**
   - テスト開始確認画面が表示される
   - 以下の情報を確認：
     - 大カテゴリー
     - 中トピック
     - 小トピック
     - 問題数：5問
     - 満点：100点
     - 所要時間：約15分
   - 「テストを開始する」ボタンをクリック

6. **📝 5問に連続で回答**
   - **進行状況バー**で現在位置を確認（問1/5 → 問2/5 → ...）
   - 各問題の配点が表示される（15点/25点/30点）
   - 選択式：選択肢をクリックして選択
   - 記述式：テキストエリアに回答を入力
   - 「次の問題へ」ボタンで次の問題へ進む
   - 最後の問題では「回答を完了する」ボタンが表示

7. **💯 テスト結果とフィードバックを確認**
   - **総合得点**（100点満点）とS〜E評価を確認
   - **各問題の得点**と達成率を確認
   - **問題ごとのフィードバック**：
     - できている点
     - 惜しい点
     - 修正が必要な点
     - 理由
     - 次に意識する一点
   - 記述式の場合：採点内訳（テキスト一致度、キーワード使用、具体性、論理性）
   - 「小トピック一覧に戻る」で他の小トピックに挑戦可能
   - 「中トピック選択に戻る」で他の中トピックを選択可能
   - 「カテゴリー選択に戻る」で他の大カテゴリーを選択可能

## 🎨 デザイン方針

- 学習環境に適した落ち着いた色調
- フィードバック構造が視覚的に明確
- できている点を強調する配色設計
- **進行状況バー**でテストの位置を直感的に把握
- **トピックカード**で学習内容を一目で理解
- レスポンシブデザイン対応

## 🎓 学習者の体験フロー

```
┌─────────────────────────────────────────┐
│  1. 大カテゴリー選択                     │
│     ├ 営業                               │
│     └ コミュニケーション                 │
│     ↓ カテゴリーを選択                   │
│  2. 中トピック選択                       │
│     （例：営業の場合）                   │
│     ├ 顧客ヒアリングの基本               │
│     ├ プレゼンテーション技術             │
│     └ クロージング技法                   │
│     ↓ 中トピックを選択                   │
│  3. 小トピック選択                       │
│     （例：顧客ヒアリングの基本の場合）   │
│     ├ 潜在ニーズを引き出す質問技法       │
│     ├ SPIN話法の実践                     │
│     └ ヒアリングシートの活用             │
│     ↓ 「テストを開始する」               │
│  4. テスト開始確認                       │
│     ↓ 「テストを開始する」               │
│  5. 問1/5 回答 (15点)                   │
│     ↓ 「次の問題へ」                     │
│  6. 問2/5 回答 (15点)                   │
│     ↓ 「次の問題へ」                     │
│  7. 問3/5 回答 (15点)                   │
│     ↓ 「次の問題へ」                     │
│  8. 問4/5 回答 (25点)                   │
│     ↓ 「次の問題へ」                     │
│  9. 問5/5 回答 (30点)                   │
│     ↓ 「回答を完了する」                 │
│ 10. テスト結果表示                       │
│     ・総合得点: XX/100点                │
│     ・各問題の結果とFB                  │
│     ・採点内訳                           │
│     ↓ 戻る選択                           │
│     ├ 小トピック一覧に戻る               │
│     ├ 中トピック選択に戻る               │
│     └ カテゴリー選択に戻る               │
└─────────────────────────────────────────┘
```

## 🔧 技術スタック

- **フロントエンド**: HTML5, CSS3, JavaScript (Vanilla)
- **フォント**: Noto Sans JP (Google Fonts)
- **アイコン**: Font Awesome 6.4.0
- **データ管理**: RESTful Table API
- **AI機能**: 
  - テキスト分析による自動問題生成
  - キーワード抽出とマッチング
  - テキスト一致度評価アルゴリズム
  - ルールベースのフィードバック生成
- **採点システム**: 
  - 100点満点評価
  - 4観点別採点（テキスト一致度、キーワード、具体性、論理性）
  - S〜E評価判定
- **セキュリティ**: 
  - Web Crypto API（暗号化・ハッシュ化）
  - SHA-256（パスワードハッシュ）
  - AES-GCM（データ暗号化）
  - レート制限（ブルートフォース対策）

## 📊 API エンドポイント

システムは以下のRESTful APIを使用しています：

- `GET tables/{table}` - レコード一覧取得
- `GET tables/{table}/{id}` - 単一レコード取得
- `POST tables/{table}` - レコード作成
- `PUT tables/{table}/{id}` - レコード更新
- `PATCH tables/{table}/{id}` - レコード部分更新
- `DELETE tables/{table}/{id}` - レコード削除

## 📝 フィードバック基準

本システムは「フィードバック基準：標準（教育向け）」に準拠しています：

### 基本スタンス
- 学習者は「理解しようとしている前提」で扱う
- 正誤の判定よりも「思考の方向性」を重視
- 間違いは修正点として扱い、人格・能力の否定は一切しない

### フィードバック出力の固定構造
1. **できている点（Good Point）** - 正しく捉えられている部分
2. **惜しい点（Partial）** - 方向性は合っているが不足している点
3. **修正が必要な点（Correction）** - 問いの意図とズレている部分
4. **理由（Why）** - なぜその評価なのかの説明
5. **次に意識する一点（Next Action）** - 具体的な改善ポイント

### ルーブリック評価（記述式）
各観点を0〜5点で評価：
- **論点理解**: 問いの本質を捉えているか
- **思考の方向性**: 適切なアプローチができているか
- **具体性**: 具体例や実践イメージがあるか
- **再現性**: 他者が実践できる内容か
- **表現の明瞭さ**: 構造化された明瞭な表現か

## 💡 トラブルシューティング

### 問題生成がうまくいかない場合

#### 🔍 デバッグ手順

1. **ブラウザのコンソールを開く**
   - F12キーを押して開発者ツールを開く
   - 「Console」タブを選択

2. **システム状態をチェック**
   ```javascript
   checkSystemStatus()
   ```
   - すべての項目が `true` になっているか確認

3. **フォーム状態をチェック**
   ```javascript
   testFormStatus()
   ```
   - フォームの各要素が見つかるか確認

4. **自動入力でテスト**
   ```javascript
   testAutoFill()
   ```
   - フォームにテストデータが入力される
   - その後、画面上の「5問を自動生成してプレビュー」ボタンをクリック

5. **直接生成関数を呼び出し**
   ```javascript
   testGenerateDirectly()
   ```
   - 問題生成関数を直接実行してエラーを確認

#### ✅ チェック項目

- [ ] **管理者としてログインしているか**
  - トップページで「管理者の方はこちら」をクリック
  - 管理者名、メールアドレス、パスワードを入力してログイン

- [ ] **問題管理タブを開いているか**
  - 管理者画面の「問題管理」タブをクリック

- [ ] **全ての必須項目を入力したか**
  - ✅ 大カテゴリー（営業 or コミュニケーション）
  - ✅ 中トピック名（例：顧客ヒアリングの基本）
  - ✅ 学習テキスト（50文字以上、推奨200文字以上）

- [ ] **ブラウザのキャッシュをクリアしたか**
  - Ctrl + Shift + Delete (Windows/Linux)
  - Cmd + Shift + Delete (Mac)
  - ページを再読み込み (F5 または Ctrl+R)

#### 🐛 よくあるエラーと対処法

| エラーメッセージ | 原因 | 対処法 |
|------------------|------|--------|
| 「カテゴリを選択してください」 | カテゴリが未選択 | 営業またはコミュニケーションを選択 |
| 「中トピック名を入力してください」 | 中トピック名が空欄 | 中トピック名を入力 |
| 「テキストが短すぎます」 | テキストが50文字未満 | 200文字以上のテキストを入力 |
| 「問題生成機能の読み込みに失敗しました」 | JSファイルが読み込まれていない | ページを再読み込み |
| フォームが送信されない | ブラウザのバリデーション | 全ての必須項目を入力 |

#### 📞 それでも解決しない場合

コンソールに表示されているエラーメッセージをコピーして、以下の情報と一緒に報告してください：
1. ブラウザの種類とバージョン
2. `checkSystemStatus()` の結果
3. `testFormStatus()` の結果
4. コンソールのエラーメッセージ（全文）

## 🔮 今後の開発推奨事項

### 未実装機能

1. **管理者パスワード変更機能**
   - 既存管理者のパスワード変更
   - パスワードリセット機能

2. **問題編集機能**
   - 既存問題の修正
   - 問題の複製機能

2. **高度な統計・分析**
   - 問題ごとの正答率
   - 学習者の成長曲線
   - ルーブリック評価の推移グラフ

3. **通知機能**
   - 新しい問題の通知
   - フィードバック完了の通知

4. **エクスポート機能**
   - 学習履歴のCSV出力
   - フィードバックのPDF出力

5. **問題バンク機能**
   - 問題のタグ付け
   - 難易度設定
   - 検索・フィルタリングの強化

6. **学習パス機能**
   - 推奨学習順序の設定
   - 前提条件の管理

7. **コメント・質問機能**
   - フィードバックへの質問
   - 管理者とのやりとり

## 💡 推奨される次のステップ

1. 実際の教育現場でのテスト運用
2. ユーザーフィードバックの収集
3. AIフィードバック精度の向上
4. より詳細な統計機能の実装
5. モバイルアプリ化の検討

## 📄 ライセンス

このプロジェクトは教育目的で作成されています。

---

**開発日**: 2026年2月5日  
**バージョン**: 6.0.0 (3階層学習構造対応版)  
**最終更新**: 2026年2月6日

## 🔒 アップデート履歴

### v6.1.0 (2026-02-06) - テスト完了処理の修正
- ✅ **テスト完了処理のエラーを修正**
  - `resultView`と`resultContent`のID不一致を解決
  - 詳細なデバッグログを追加
  - テスト結果表示用のCSSを追加
- ✅ **結果画面のスタイリング**
  - result-header, result-score-display等のスタイル追加
  - feedback-section（good/partial/correction/reason/breakdown/next-action）
  - breakdown-itemsグリッドレイアウト
- ✅ **関数の修正**
  - `sanitizeHTML`関数をutils.jsに追加
  - `scoreEssayAnswer`関数をscoring.jsに追加
  - `generateFeedback`関数をai.jsで拡張（新しいシグネチャに対応）

### v6.0.0 (2026-02-06) - 3階層学習構造の実装 🎉
- ✅ **3階層の学習ナビゲーション構造**
  - 大カテゴリー（営業/コミュニケーション）選択画面
  - 中トピック選択画面（各大カテゴリー内）
  - 小トピック選択画面（各中トピック内）
- ✅ **データ構造の拡張**
  - question_setsテーブルにmid_topic（中トピック）フィールドを追加
  - 階層的なデータ管理の実現
- ✅ **管理者機能の強化**
  - 問題作成時に中トピック名を入力可能に
  - プレビュー画面に中トピック表示を追加
  - 保存時に階層情報を含めて保存
- ✅ **学習者画面の再設計**
  - カテゴリーカード（大カテゴリー）の視覚的デザイン
  - 中トピックカードの追加
  - 小トピックカードの改善
  - 各階層での戻るボタンの実装
- ✅ **CSSの追加**
  - category-grid, category-card のスタイル
  - mid-topic-card のスタイル
  - 階層構造を視覚的に表現するデザイン
- ✅ **ナビゲーションの改善**
  - 階層間の移動をスムーズに
  - パンくずリスト的な体験の実現
  - 現在の位置が分かりやすい表示

### v5.1.6 (2026-02-07) - フィードバックと評価ロジックの大幅改善
- 🎯 **テキストに沿った的確なフィードバックを実現**
  - テキストのキーワードに基づいた詳細な評価
  - 使用/未使用キーワードの明確な提示
  - キーワード使用による加点の具体的な提示
  - 回答の強みと改善点を個別に分析
- ✅ **詳細な採点内訳の表示**
  - 4つの評価観点ごとに詳細な説明を追加
  - 各項目で「なぜこの点数なのか」を明示
  - 「このキーワードを使うと+○点」のような具体的な改善策
  - 達成率をパーセンテージで表示
- ✅ **模範解答の追加**
  - すべての問題に模範解答を自動生成
  - テキストの内容を活用した実践的な解答例
  - 解答のポイントを箇条書きで明示
  - 選択式：正解の選択肢と理由を詳述
  - 記述式：テキストのキーワードを使った模範的な回答

### v5.1.7 (2026-02-07) - 選択問題の品質向上
- 🎯 **長い文章が途切れる問題を解決**
  - 正解選択肢の最大長を150文字から200文字に拡張
  - 文の区切り（。！？）で適切に分割
  - 句読点（、）を考慮した自然な短縮
  - ダミー選択肢は120文字まで（正解より短く設定）
- 🎯 **選択問題の難易度を大幅に向上**
  - テキスト内の他のコンセプトを使った紛らわしい選択肢
  - キーワードを混ぜた部分的に正しい選択肢
  - 一般論で紛らわしい選択肢
  - 明らかに間違った選択肢を排除
- ✅ **選択肢の表示改善**
  - 長いテキストが適切に折り返すCSS改善
  - 選択肢のレイアウトを上揃えに変更
  - ラベルの行高を最適化

### v5.1.8 (2026-02-10) - 🏆 世界最高峰の教育者レベルのAI採点・フィードバックシステム
- 🌟 **世界最高峰の教育者レベルのフィードバック実装**
  - **建設的な批評**: 学習者の努力を認めつつ、具体的な改善点を示す
  - **成長志向**: 「できない」ではなく「まだできていない」の視点
  - **具体性**: 抽象的な助言ではなく、実行可能なアクションを提示
  - **公平性**: 評価基準を明確にし、透明性を保つ
  - **励まし**: 学習者の自信と意欲を高める言葉選び
  
- 🎯 **AI採点精度の大幅向上（記述式問題）**
  - **テキスト一致度（50点満点）**
    - キーワード使用の正確性（25点）: 使用率＋文脈適切性
    - テキスト内容の理解度（15点）: 文の類似度分析
    - 文脈の適切性（10点）: キーワードの共起関係を評価
  - **キーワード使用（20点満点）**
    - 全キーワードの使用状況を正確にカウント
  - **具体性（15点満点）**
    - 具体例の有無（0-6点）: 「例えば」などの表現
    - 数値・固有名詞の使用（0-4点）: データに基づく記述
    - 詳細な描写（0-3点）: 文章量と情報密度
    - 実践的な内容（0-2点）: ステップや手順の明示
  - **論理性・構造（15点満点）**
    - 文章の長さの適切性（0-4点）
    - 論理展開の明確さ（0-5点）: 因果関係を示す言葉の使用
    - 構造の整理（0-3点）: 段落分けや改行
    - 接続詞の使用（0-3点）: 論理的な接続

- ✨ **記述式問題の詳細フィードバック**
  - **できている点**
    - 使用したキーワードを列挙（達成率表示）
    - 文量・具体性・論理性を個別に評価
    - 優れた点を「【優れた点】」として強調
    - 具体的な強みを特定して褒める
  - **惜しい点（成長の機会）**
    - 未使用キーワードを具体的に指摘（個数と名称）
    - 文量不足の場合は「あと○文字」と具体的に提示
    - 💡ヒントマーク付きで改善のコツを提示
    - 「△」マークで改善の余地を視覚化
  - **修正が必要な点**
    - 重大な問題のみを指摘（励ましを忘れない）
    - 「✗」マークで明確に示す
    - 具体的な修正方法を「→」で提示
  - **詳細な採点内訳**
    - 4つの観点ごとに得点と満点を表示
    - 各項目で「なぜこの点数なのか」を説明
    - 「+○点アップ可能」と具体的な改善効果を提示
    - 絵文字（1️⃣2️⃣3️⃣4️⃣）で視覚的に整理
  - **評価の理由**
    - 達成率に応じた総合評価（✓○△✗）
    - 評価のポイントを箇条書きで明示
  - **次に意識する一点**
    - 最も重要な改善アクションを1つに絞る
    - 具体的な実践方法を提示

- 🌟 **模範解答の自動生成（世界最高峰レベル）**
  - **理解を問う問題**
    - 概要: キーワードを使った要約
    - 詳細: テキストの重要文を論理的に配置
    - 具体例: 実践的な例を追加
  - **実践・応用を問う問題**
    - 実践のポイント: ステップバイステップで説明
    - 具体的な実践例: リアルな場面設定
    - 期待される成果: 実践の効果を明示
  - **その他の問題**
    - 回答のポイント: キーワードを中心に構成
    - 内容: テキストの関連文を組み込む
    - 要約: 最後に要点をまとめる
  - **すべての模範解答に共通**
    - 全ての評価基準キーワードを自然に使用
    - 200〜400文字の適切な文量
    - 具体例を含む実践的な内容
    - 論理的な構造で記述
    - 文字数の目安を表示

- 📊 **採点アルゴリズムの精緻化**
  - キーワードの文脈適切性を評価（助詞や接続詞との組み合わせ）
  - テキストとの類似度を文単位で計算
  - キーワードの共起関係を距離で評価（近いほど高得点）
  - 具体例・数値・単位の使用を多角的に評価
  - 因果関係を示す言葉の頻度を詳細にカウント
  - 段落構成と接続詞の使用を詳細に分析

- 🎨 **フィードバックUIの改善**
  - 絵文字を効果的に使用（✓○△✗、💡、1️⃣2️⃣3️⃣4️⃣）
  - 色分けされたセクション（できている点=緑、惜しい点=黄、修正点=赤）
  - 模範解答は青背景で目立つように表示
  - 詳細な採点内訳は灰色背景でデータとして整理
  - キーワード分析に基づく具体的なアドバイス

### v5.1.5 (2026-02-07) - 問題生成ロジックの大幅改善
- 🎯 **テキスト内容に沿った問題生成を実現**
  - テンプレートベースから動的生成に変更
  - テキストから主要な概念を抽出する機能を追加
  - キーワード出現頻度分析の強化（上位10個まで）
  - 重要な文の抽出アルゴリズムを改善
- ✅ **選択式問題の改善**
  - テキストの実際の内容から正解選択肢を生成
  - 正解：テキストの文章をそのまま使用（最大50文字）
  - ダミー選択肢：カテゴリに応じた適切なダミーを生成
  - 選択肢をランダムにシャッフル（正解位置を固定しない）
  - 問題文：「テキストの内容に最も合致するのは？」形式
- ✅ **記述式問題の改善**
  - 4問目：テキスト内容の理解を問う（説明問題）
  - 5問目：テキスト内容の応用を問う（実践問題）
  - 評価基準：テキストから抽出した重要キーワードを使用
  - 評価ポイントを明確に提示
- ✅ **テキスト分析の強化**
  - extractMainConcepts関数を追加（キーワードと文脈を抽出）
  - キーワードを含む文の抽出精度を向上
  - カテゴリ別キーワードリストを拡充
  - 詳細なログ出力でデバッグを容易に
- ✅ **ユーティリティ関数の追加**
  - shuffleArray: 配列をランダムにシャッフル
  - generateDummyChoices: カテゴリ別のダミー選択肢生成

### v5.1.4 (2026-02-06) - ログインリンクのクリック問題修正
- 🚨 **「管理者の方はこちら」ボタンが押せない問題を緊急修正**
  - HTMLの`href="#"`を`href="javascript:void(0)"`に変更
  - インラインスタイルに`cursor: pointer`、`display: inline-block`、`padding: 10px`を追加
  - `user-select: none`を追加してテキスト選択を防止
  - onclick属性を追加（バックアップとして）
- ✅ **JavaScriptのイベントリスナー強化**
  - クローン方式でイベントリスナーを完全にリセット
  - addEventListener + onclick の二重設定
  - capture: false, passive: false の明示的な指定
  - グローバル関数`window.switchToAdminLogin`と`window.switchToLearnerLogin`を追加
- ✅ **詳細なデバッグログ**
  - リンククリック時のログ強化
  - イベントリスナー設定完了ログ

### v5.1.3 (2026-02-06) - 記述式採点エラーの緊急修正
- 🚨 **記述式採点の重大なバグを修正**
  - `scoreEssayAnswer`関数で`evaluateTextAlignment`に数値を渡していた問題を修正
  - キーワード配列を正しく渡すように変更
  - 採点計算ロジックを修正（各評価項目を正しく満点に応じて調整）
- ✅ **全採点関数にエラーハンドリングを追加**
  - `scoreEssayAnswer`: 詳細なログ出力とtry-catch
  - `scoreEssayAnswerForSet`: 詳細なログ出力とtry-catch
  - `evaluateTextAlignment`: 引数の型チェック
  - `evaluateKeywordUsage`: 配列チェックと空文字チェック
  - `evaluateSpecificity`: 空文字チェック
  - `evaluateStructure`: 空文字チェック
  - `calculateSimilarity`: null/undefinedチェック
- ✅ **デバッグログの追加**
  - 各評価関数で詳細なスコアログを出力
  - キーワード抽出の確認ログ
  - 最終スコア計算の確認ログ

### v5.1.2 (2026-02-06) - テスト完了処理のエラーハンドリング強化
- ✅ **completeTest関数のエラーハンドリング強化**
  - 回答データの存在チェックを追加
  - 学習者情報の妥当性検証を追加
  - 各処理ステップでの詳細なエラーログ出力
  - try-catchブロックによるエラーの詳細な捕捉
- ✅ **採点・フィードバック生成のエラーハンドリング**
  - 選択式・記述式それぞれでのエラー捕捉
  - フィードバック生成失敗時の詳細なエラーメッセージ
  - 配点・元テキスト抽出失敗時のデフォルト値設定
- ✅ **デバッグログの強化**
  - 各処理ステップでの詳細なログ出力
  - questionオブジェクトの内容確認
  - sanitizeHTML関数の存在確認
  - 結果表示の成功・失敗ログ

### v5.1.1 (2026-02-06) - ログアウト・カテゴリー選択の修正
- ✅ **ログアウトボタンの修正**
  - HTMLのインラインonclick属性を削除
  - イベントリスナーの重複登録を防止
  - クローン方式によるイベントハンドラーのクリーンアップ
  - 学習者・管理者の両方のログアウトボタンを修正
- ✅ **カテゴリーカード選択の修正**
  - イベントデリゲーション方式に変更
  - イベントリスナーの重複登録を防止
  - クローン方式によるイベントハンドラーのクリーンアップ
- ✅ デバッグログの強化
  - ログアウトボタンクリック時のログ追加
  - カテゴリーカード選択時のログ追加
  - logout関数の実行ログ追加

### v5.1.0 (2026-02-06) - 管理者リンク修正・デバッグ強化
- ✅ **「管理者の方はこちら」リンクの修正**
  - イベントリスナーのnullチェックを追加
  - クリックイベントのstopPropagation追加
  - cursor: pointerとpointerEvents: autoを明示的に設定
- ✅ デバッグログの追加
  - initLogin実行時の詳細ログ
  - イベントリスナー追加の確認ログ
  - リンククリック時のログ
- ✅ 未使用関数の削除
  - selectQuestion、deleteQuestion、selectChoice関数のコメントアウト
- ✅ エラーハンドリングの改善
  - 全てのイベントリスナーにnullチェックを追加
  - より詳細なエラーメッセージ

### v5.0.0 (2026-02-06) - トピック選択・テスト形式の実装
- ✅ **小トピック選択方式**の導入
- ✅ トピック一覧画面の実装
- ✅ 「テストを開始する」ボタンからの5問連続回答
- ✅ **進行状況バー**の実装（問1/5 → 問2/5 → ...）
- ✅ テスト開始確認画面
- ✅ **テスト完了後の総合結果画面**
  - 100点満点の総合得点表示
  - S〜E評価
  - 各問題の結果一覧
  - 問題ごとのフィードバック要約
- ✅ トピック完了状況の管理
- ✅ 再挑戦機能

### v4.0.0 (2026-02-06) - セット単位100点満点採点システム
- ✅ **1テキスト = 5問セット = 100点満点** の構成に変更
- ✅ 選択式15点×3問＝45点の配点設定
- ✅ 記述式25点+30点＝55点の配点設定
- ✅ 問題セットの概念を導入（question_setsテーブル）
- ✅ 問題番号による自動配点計算
- ✅ プレビュー画面に配点情報を表示
- ✅ フィードバック画面に配点と達成率を表示
- ✅ セット全体の得点確認機能の案内追加

### v3.0.0 (2026-02-05) - 自動問題生成・100点満点採点
- ✅ テキスト貼り付けによる自動問題生成機能
- ✅ 1テキストから5問（選択式3問+記述式2問）を自動生成
- ✅ 100点満点の採点システム
- ✅ テキストとの一致度を4観点で評価
- ✅ S〜E評価の成績判定
- ✅ 採点内訳の可視化（グラフ表示）
- ✅ 問題生成のプレビュー機能

### v2.0.0 (2026-02-05) - セキュリティ強化
- ✅ 管理者専用ログイン画面の分離
- ✅ 管理者パスワード認証の実装（SHA-256ハッシュ化）
- ✅ パスワード強度チェック機能
- ✅ レート制限によるブルートフォース攻撃対策
- ✅ セッション管理の強化（有効期限管理）
- ✅ XSS対策（入力サニタイズ）
- ✅ AES-GCM暗号化機能の実装
- ✅ セキュアなログアウト機能

### v1.0.0 (2026-02-05) - 初回リリース
- 初回リリース
- 基本機能の実装
