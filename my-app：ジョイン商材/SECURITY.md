# セキュリティガイド

## 📋 概要

本システムは営業・コミュニケーション学習支援を目的としており、複数のセキュリティ層で保護されています。このドキュメントでは、実装されているセキュリティ機能と運用上の注意事項を説明します。

## 🔐 実装されているセキュリティ機能

### 1. 認証システム

#### 学習者認証
- **簡易認証**: 名前とメールアドレスのみ
- **目的**: 学習者の利便性を優先（教育環境での使用を想定）
- **制限**: 管理者機能へのアクセス不可

#### 管理者認証
- **強力な認証**: パスワード必須
- **初回登録時**: パスワード設定（強度チェック付き）
- **2回目以降**: メールアドレス + パスワード
- **パスワード要件**:
  - 最低8文字
  - 大文字を含む（A-Z）
  - 小文字を含む（a-z）
  - 数字を含む（0-9）
  - 記号を含む（!@#$%^&*など）

### 2. パスワードセキュリティ

#### ハッシュ化
```javascript
// SHA-256を使用したパスワードハッシュ化
// 平文パスワードは保存されません
async function hashPassword(password) {
    // Web Crypto APIを使用
    const hashBuffer = await crypto.subtle.digest('SHA-256', data);
    // 16進数文字列に変換
    return hashHex;
}
```

#### 保存形式
```json
{
  "admin@example.com": {
    "passwordHash": "5e884898da28047151d0e56f8dc6292773603d0d6aabbdd62a11ef721d1542d8",
    "createdAt": "2026-02-05T10:30:00.000Z",
    "lastLogin": "2026-02-05T14:45:00.000Z"
  }
}
```

### 3. ブルートフォース攻撃対策

#### レート制限
- **試行制限**: 15分間に5回まで
- **ロック期間**: 15分間
- **通知**: 残り試行回数を表示

```javascript
// レート制限の実装
class RateLimiter {
    constructor(maxAttempts = 5, windowMs = 15 * 60 * 1000) {
        // 5回の試行、15分のウィンドウ
    }
}
```

### 4. セッション管理

#### セッショントークン
- **生成**: 暗号学的に安全な乱数生成器
- **長さ**: 32バイト（64文字の16進数）
- **一意性**: UUID v4相当の衝突耐性

#### 有効期限
- **学習者**: 24時間
- **管理者**: 8時間（セキュリティ強化）
- **自動ログアウト**: 期限切れ時

### 5. XSS（クロスサイトスクリプティング）対策

#### 入力サニタイズ
すべてのユーザー入力は以下の文字をエスケープ:
- `&` → `&amp;`
- `<` → `&lt;`
- `>` → `&gt;`
- `"` → `&quot;`
- `'` → `&#x27;`
- `/` → `&#x2F;`

### 6. データ暗号化

#### AES-GCM暗号化
```javascript
// 機密データの暗号化（必要に応じて使用）
async function encryptData(data, key) {
    // AES-GCM: 認証付き暗号化
    // 256ビット鍵、12バイトIV
}
```

## 🛡️ セキュリティの限界と対策

### LocalStorageの制限

#### 現在の実装
- ブラウザのLocalStorageを使用
- 同一ブラウザ・同一ドメインからアクセス可能
- 開発者ツールから閲覧可能（ハッシュ化されたデータのみ）

#### 制限事項
- **物理的アクセス**: PCに物理アクセスがある場合、LocalStorageの内容を閲覧される可能性
- **XSS脆弱性**: 他のサイトからのXSS攻撃には脆弱（ただし本システムは入力をサニタイズ）
- **共有PC**: ログアウトしないとセッションが残る

#### 対策
1. **必ずログアウト**: 使用後は必ずログアウトする
2. **信頼できる環境**: 管理者は信頼できるPCからのみアクセス
3. **HTTPS使用**: 本番環境では必ずHTTPSを使用

### 本番環境での推奨事項

#### 必須対策
1. **HTTPS通信**
   - SSL/TLS証明書の導入
   - HTTP → HTTPS自動リダイレクト

2. **セキュリティヘッダー**
   ```
   Content-Security-Policy: default-src 'self'
   X-Frame-Options: DENY
   X-Content-Type-Options: nosniff
   Referrer-Policy: no-referrer
   ```

3. **サーバーサイド認証**
   - JWT（JSON Web Token）
   - OAuth 2.0
   - セッションストアをサーバーに移行

#### 推奨対策
1. **監査ログ**
   - すべてのログイン試行を記録
   - 管理者の操作履歴
   - 異常なアクセスパターンの検知

2. **バックアップ**
   - 定期的なデータバックアップ
   - 復旧手順の文書化

3. **アクセス制限**
   - IPアドレスホワイトリスト（管理者）
   - VPN経由のアクセス

## 🔍 セキュリティ運用ガイド

### 管理者の責務

1. **強力なパスワードの設定**
   ```
   ✅ 良い例: Admin@2026!SecurePass#Education
   ❌ 悪い例: admin123, password
   ```

2. **パスワードの管理**
   - パスワードマネージャーの使用推奨
   - パスワードの使い回し禁止
   - 定期的な変更（3ヶ月ごと推奨）

3. **アクセス管理**
   - 管理者アカウントは最小限に
   - 学習者に管理者パスワードを共有しない
   - 退職者のアカウント削除

### 学習者の責務

1. **正確な情報入力**
   - 実名とメールアドレスの入力
   - 他人になりすまない

2. **セッション管理**
   - 共有PCでは必ずログアウト
   - 他人のアカウントでログインしない

### インシデント対応

#### 不正ログインの疑い
1. すぐに管理者パスワードを変更
2. LocalStorageをクリア（ブラウザの設定から）
3. 全学習者にログアウトを依頼

#### データ漏洩の疑い
1. システムの一時停止
2. 影響範囲の調査
3. 関係者への通知

## 📊 セキュリティチェックリスト

### 初期設定時
- [ ] 管理者の強力なパスワードを設定
- [ ] HTTPSでアクセス可能か確認
- [ ] ブラウザが最新版か確認
- [ ] セキュリティヘッダーの設定（可能な場合）

### 日常運用
- [ ] 使用後は必ずログアウト
- [ ] 不審なログイン試行がないか確認
- [ ] 定期的なパスワード変更（管理者）
- [ ] データのバックアップ

### 定期レビュー（月次）
- [ ] 学習者リストの確認
- [ ] 不要なアカウントの削除
- [ ] システムの動作確認
- [ ] セキュリティアップデートの確認

## 🚨 セキュリティに関する連絡

セキュリティ上の問題を発見した場合は、速やかにシステム管理者に報告してください。

---

**注意**: このドキュメントは、本システムのセキュリティ機能を説明するものです。完全なセキュリティを保証するものではありません。運用環境や用途に応じて、追加のセキュリティ対策を検討してください。
